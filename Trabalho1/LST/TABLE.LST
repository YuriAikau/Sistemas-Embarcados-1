     1                                  global draw_table, draw_position
     2                                  global proximo_jogador
     3                                  global len_campo_input, altura_input
     4                                  extern circle, line, cursor, caracter
     5                                  extern invalid_player, double_play, invalid_position, clear_character, draw_previous_cmd, clear_cmd
     6                                  extern cor, cyan_claro, magenta_claro, branco_intenso, amarelo
     7                                  segment code
     8                                  ..start:
     9                                  
    10                                  draw_table:
    11 00000000 9C                          pushf
    12 00000001 50                          push 		ax
    13 00000002 53                          push 		bx
    14 00000003 51                          push		cx
    15 00000004 52                          push		dx
    16 00000005 56                          push		si
    17 00000006 57                          push		di
    18 00000007 55                          push		bp
    19                                  
    20                                      ; desenhando o fundo do jogo da velha
    21 00000008 C706[0000][0000]            mov		word[cor],branco_intenso
    22 0000000E B81400                      mov		ax,offset_tabela_x
    23 00000011 50                          push		ax
    24 00000012 B8E600                      mov		ax,offset_tabela_y+altura_y
    25 00000015 50                          push		ax
    26 00000016 B86C02                      mov		ax,fim_tabela_x
    27 00000019 50                          push		ax
    28 0000001A B8E600                      mov		ax,offset_tabela_y+altura_y
    29 0000001D 50                          push		ax
    30 0000001E E8(0000)                    call		line
    31                                  
    32 00000021 C706[0000][0000]            mov		word[cor],branco_intenso
    33 00000027 B81400                      mov		ax,offset_tabela_x
    34 0000002A 50                          push		ax
    35 0000002B B85401                      mov		ax,offset_tabela_y+2*altura_y
    36 0000002E 50                          push		ax
    37 0000002F B86C02                      mov		ax,fim_tabela_x
    38 00000032 50                          push		ax
    39 00000033 B85401                      mov		ax,offset_tabela_y+2*altura_y
    40 00000036 50                          push		ax
    41 00000037 E8(0000)                    call		line
    42                                  
    43 0000003A C706[0000][0000]            mov		word[cor],branco_intenso
    44 00000040 B8DC00                      mov		ax,offset_tabela_x+largura_x
    45 00000043 50                          push		ax
    46 00000044 B87800                      mov		ax,offset_tabela_y
    47 00000047 50                          push		ax
    48 00000048 B8DC00                      mov		ax,offset_tabela_x+largura_x
    49 0000004B 50                          push		ax
    50 0000004C B8C201                      mov		ax,fim_tabela_y
    51 0000004F 50                          push		ax
    52 00000050 E8(0000)                    call		line
    53                                  
    54 00000053 C706[0000][0000]            mov		word[cor],branco_intenso
    55 00000059 B8A401                      mov		ax,offset_tabela_x+2*largura_x
    56 0000005C 50                          push		ax
    57 0000005D B87800                      mov		ax,offset_tabela_y
    58 00000060 50                          push		ax
    59 00000061 B8A401                      mov		ax,offset_tabela_x+2*largura_x
    60 00000064 50                          push		ax
    61 00000065 B8C201                      mov		ax,fim_tabela_y
    62 00000068 50                          push		ax
    63 00000069 E8(0000)                    call		line
    64                                  
    65 0000006C B91600                      mov cx, len_campo_input ; número de caracteres na mensagem "Campo de comando: "
    66 0000006F 31DB                        xor bx,bx
    67 00000071 B600                        mov dh,altura_input
    68 00000073 B202                        mov dl,2
    69 00000075 C706[0000][0000]            mov word[cor], branco_intenso
    70                                  
    71                                  draw_input:
    72 0000007B E8(0000)                    call	cursor
    73 0000007E 8A87[0700]                  mov     al,[bx+campo_input]
    74 00000082 E8(0000)                    call	caracter
    75 00000085 43                          inc     bx			;proximo caracter
    76 00000086 FEC2                        inc		dl			;avanca a coluna
    77 00000088 E2F1                        loop    draw_input
    78                                  
    79 0000008A B91200                      mov cx, len_campo_cmd ; número de caracteres na mensagem "Campo de comando: "
    80 0000008D 31DB                        xor bx,bx
    81 0000008F B619                        mov dh,altura_cmd
    82 00000091 B202                        mov dl,2
    83 00000093 C706[0000][0000]            mov word[cor], branco_intenso
    84                                  
    85                                  draw_cmd:
    86 00000099 E8(0000)                    call	cursor
    87 0000009C 8A87[1D00]                  mov     al,[bx+campo_cmd]
    88 000000A0 E8(0000)                    call	caracter
    89 000000A3 43                          inc     bx			;proximo caracter
    90 000000A4 FEC2                        inc		dl			;avanca a coluna
    91 000000A6 E2F1                        loop    draw_cmd
    92                                  
    93 000000A8 B91400                      mov cx, len_campo_msg ; número de caracteres na mensagem "Campo de mensagens: "
    94 000000AB 31DB                        xor bx,bx
    95 000000AD B61B                        mov dh,altura_msg
    96 000000AF B202                        mov dl,2
    97 000000B1 C706[0000][0000]            mov word[cor], branco_intenso
    98                                  
    99                                  draw_msg:
   100 000000B7 E8(0000)                    call	cursor
   101 000000BA 8A87[2F00]                  mov     al,[bx+campo_msg]
   102 000000BE E8(0000)                    call	caracter
   103 000000C1 43                          inc     bx			;proximo caracter
   104 000000C2 FEC2                        inc		dl			;avanca a coluna
   105 000000C4 E2F1                        loop    draw_msg
   106                                  
   107 000000C6 5D                          pop		bp
   108 000000C7 5F                          pop		di
   109 000000C8 5E                          pop		si
   110 000000C9 5A                          pop		dx
   111 000000CA 59                          pop		cx
   112 000000CB 5B                          pop		bx
   113 000000CC 58                          pop		ax
   114 000000CD 9D                          popf
   115 000000CE C3                          ret
   116                                  
   117                                  ;_____________________________________________________________________________
   118                                  ;   funcao desenha_posicao
   119                                  ;   push symbol; push x; push y; call draw_position; (0<=x<=2) e (0<=y<=2)
   120                                  draw_position:
   121 000000CF 55                          push bp
   122 000000D0 89E5                        mov bp,sp
   123 000000D2 9C                          pushf
   124 000000D3 50                          push 		ax
   125 000000D4 53                          push 		bx
   126 000000D5 51                          push		cx
   127 000000D6 52                          push		dx
   128 000000D7 56                          push		si
   129 000000D8 57                          push		di
   130                                  
   131 000000D9 B81400                      mov ax,len_campo_msg
   132 000000DC 50                          push ax
   133 000000DD B83200                      mov ax,50
   134 000000E0 50                          push ax
   135 000000E1 B81B00                      mov ax,altura_msg
   136 000000E4 50                          push ax
   137 000000E5 E8(0000)                    call clear_character
   138                                  
   139 000000E8 8B4604                      mov ax,[bp+4] ;posicao c da tabela (1-3)
   140 000000EB 3D0300                      cmp ax,3
   141 000000EE 774F                        ja invalid_pos
   142 000000F0 3D0100                      cmp ax,1
   143 000000F3 724A                        jb invalid_pos
   144                                  
   145 000000F5 8B4606                      mov ax,[bp+6] ;posicao l da tabela (1-3)
   146 000000F8 3D0300                      cmp ax,3
   147 000000FB 7742                        ja invalid_pos
   148 000000FD 3D0100                      cmp ax,1
   149 00000100 723D                        jb invalid_pos
   150                                  
   151 00000102 8B4608                      mov ax,[bp+8] ;caractere ASCII correspondente ao símbolo a ser desenhado
   152 00000105 3B06[0000]                  cmp ax,[jogador_anterior]
   153 00000109 742E                        je double_play_jmp
   154                                  
   155 0000010B 3D5800                      cmp ax,'X'
   156 0000010E 740B                        je draw_ecks1
   157 00000110 3D4300                      cmp ax,'C'
   158 00000113 7415                        je draw_circle1
   159                                  
   160 00000115 E8(0000)                    call invalid_player
   161                                  
   162 00000118 E9F800                      jmp draw_position_end
   163                                  
   164                                  draw_ecks1:
   165 0000011B C706[0000][0000]            mov word[cor], magenta_claro
   166 00000121 E8(0000)                    call draw_previous_cmd
   167 00000124 E8(0000)                    call clear_cmd
   168 00000127 E95600                      jmp draw_ecks
   169                                  
   170                                  draw_circle1:
   171 0000012A C706[0000][0000]            mov word[cor], cyan_claro
   172 00000130 E8(0000)                    call draw_previous_cmd
   173 00000133 E8(0000)                    call clear_cmd
   174 00000136 E90C00                      jmp draw_circle
   175                                  
   176                                  double_play_jmp:
   177 00000139 E8(0000)                    call double_play
   178                                  
   179 0000013C E9D400                      jmp draw_position_end
   180                                  
   181                                  invalid_pos:
   182 0000013F E8(0000)                    call invalid_position
   183 00000142 E9CE00                      jmp draw_position_end
   184                                  draw_circle:
   185 00000145 C706[0000][0000]            mov word[cor], cyan_claro
   186                                  
   187 0000014B 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   188 0000014E 48                          dec ax
   189 0000014F B3C8                        mov bl,largura_x
   190 00000151 F6E3                        mul bl
   191 00000153 057800                      add ax,offset_tabela_x+(largura_x/2)
   192 00000156 50                          push ax
   193                                  
   194 00000157 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   195 0000015A 48                          dec ax
   196 0000015B B36E                        mov bl,altura_y
   197 0000015D F6E3                        mul bl
   198 0000015F 055500                      add ax,margem_y+(altura_y/2)
   199 00000162 31DB                        xor bx,bx
   200 00000164 BBDF01                      mov bx,479
   201 00000167 29C3                        sub bx,ax
   202 00000169 53                          push bx
   203                                  
   204 0000016A B82D00                      mov ax,(altura_y/2)-offset_quadrado_y
   205 0000016D 50                          push ax
   206                                  
   207 0000016E E8(0000)                    call circle
   208                                  
   209 00000171 B84300                      mov ax,'C'
   210 00000174 A3[0000]                    mov word[jogador_anterior],ax
   211 00000177 B85800                      mov ax,'X'
   212 0000017A A3[0200]                    mov word[proximo_jogador],ax
   213                                  
   214 0000017D E99300                      jmp draw_position_end
   215                                  
   216                                  draw_ecks:
   217 00000180 C706[0000][0000]            mov word[cor], magenta_claro
   218                                  ; desenhando a primeira "barra" do X
   219 00000186 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   220 00000189 48                          dec ax
   221 0000018A B3C8                        mov bl,largura_x
   222 0000018C F6E3                        mul bl
   223 0000018E 051E00                      add ax,offset_tabela_x+offset_quadrado_x
   224 00000191 50                          push ax ; posicao x1 da função line
   225                                  
   226 00000192 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   227 00000195 48                          dec ax
   228 00000196 B36E                        mov bl,altura_y
   229 00000198 F6E3                        mul bl
   230 0000019A 052800                      add ax,margem_y+offset_quadrado_y
   231 0000019D 31DB                        xor bx,bx
   232 0000019F BBDF01                      mov bx,479
   233 000001A2 29C3                        sub bx,ax
   234 000001A4 53                          push bx ; posicao y1 da função line
   235                                  
   236 000001A5 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   237 000001A8 B3C8                        mov bl,largura_x
   238 000001AA F6E3                        mul bl
   239 000001AC 050A00                      add ax,offset_tabela_x-offset_quadrado_x
   240 000001AF 50                          push ax ; posicao x2 da função line
   241                                  
   242 000001B0 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   243 000001B3 B36E                        mov bl,altura_y
   244 000001B5 F6E3                        mul bl
   245 000001B7 051400                      add ax,margem_y-offset_quadrado_y
   246 000001BA 31DB                        xor bx,bx
   247 000001BC BBDF01                      mov bx,479
   248 000001BF 29C3                        sub bx,ax
   249 000001C1 53                          push bx ; posicao y2 da função line
   250                                  
   251 000001C2 E8(0000)                    call line
   252                                  
   253                                  ; desenhando a segunda "barra" do X
   254 000001C5 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   255 000001C8 48                          dec ax
   256 000001C9 B3C8                        mov bl,largura_x
   257 000001CB F6E3                        mul bl
   258 000001CD 051E00                      add ax,offset_tabela_x+offset_quadrado_x
   259 000001D0 50                          push ax ; posicao x1 da função line
   260                                  
   261 000001D1 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   262 000001D4 B36E                        mov bl,altura_y
   263 000001D6 F6E3                        mul bl
   264 000001D8 051400                      add ax,margem_y-offset_quadrado_y
   265 000001DB 31DB                        xor bx,bx
   266 000001DD BBDF01                      mov bx,479
   267 000001E0 29C3                        sub bx,ax
   268 000001E2 53                          push bx ; posicao y1 da função line
   269                                  
   270 000001E3 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   271 000001E6 B3C8                        mov bl,largura_x
   272 000001E8 F6E3                        mul bl
   273 000001EA 050A00                      add ax,offset_tabela_x-offset_quadrado_x
   274 000001ED 50                          push ax ; posicao x2 da função line
   275                                  
   276 000001EE 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   277 000001F1 48                          dec ax
   278 000001F2 B36E                        mov bl,altura_y
   279 000001F4 F6E3                        mul bl
   280 000001F6 052800                      add ax, margem_y+offset_quadrado_y
   281 000001F9 31DB                        xor bx,bx
   282 000001FB BBDF01                      mov bx,479
   283 000001FE 29C3                        sub bx,ax
   284 00000200 53                          push bx ; posicao y2 da função line
   285                                  
   286 00000201 E8(0000)                    call line
   287                                  
   288 00000204 B85800                      mov ax,'X'
   289 00000207 A3[0000]                    mov word[jogador_anterior],ax
   290 0000020A B84300                      mov ax,'C'
   291 0000020D A3[0200]                    mov word[proximo_jogador],ax
   292                                  
   293 00000210 E90000                      jmp draw_position_end
   294                                  
   295                                  draw_position_end:
   296 00000213 5F                          pop		di
   297 00000214 5E                          pop		si
   298 00000215 5A                          pop		dx
   299 00000216 59                          pop		cx
   300 00000217 5B                          pop		bx
   301 00000218 58                          pop		ax
   302 00000219 9D                          popf
   303 0000021A 5D                          pop		bp
   304 0000021B C20600                      ret 6
   305                                  
   306                                  segment data
   307                                  ;coordenadas do inicio (canto inferior esquerdo) e do fim (canto superior direito) da tabela do jogo da velha
   308                                      offset_tabela_x     equ     20
   309                                      offset_tabela_y     equ     120
   310                                      margem_y            equ     30
   311                                      fim_tabela_x        equ     620
   312                                      fim_tabela_y        equ     450
   313                                  
   314                                  ; dimensoes e offsets de cada quadradinho do jogo da velha
   315                                      offset_quadrado_x   equ     10
   316                                      offset_quadrado_y   equ     10
   317                                      largura_x           equ     200
   318                                      altura_y            equ     110
   319                                  
   320                                  ; vez do jogador anterior
   321 00000000 2000                        jogador_anterior    dw      ' '
   322 00000002 2000                        proximo_jogador     dw      ' '
   323                                  
   324                                  ; valores possíveis de linhas e colunas
   325 00000004 313233                      n_linhas_colunas    db      '1','2','3'
   326                                  
   327                                  ; strings pertencentes à tela
   328 00000007 446967697465206F20-         campo_input         db      'Digite o seu comando: '
   329 00000010 73657520636F6D616E-
   330 00000019 646F3A20           
   331                                      len_campo_input     equ     22
   332                                      altura_input        equ     0
   333 0000001D 43616D706F20646520-         campo_cmd           db      'Campo de comando: '
   334 00000026 636F6D616E646F3A20 
   335                                      len_campo_cmd       equ     18
   336                                      altura_cmd          equ     25
   337 0000002F 43616D706F20646520-         campo_msg           db      'Campo de mensagens: '
   338 00000038 6D656E736167656E73-
   339 00000041 3A20               
   340                                      len_campo_msg       equ     20
   341                                      altura_msg          equ     27
   342                                  
   343                                  segment stack stack
   344 00000000 <res 00000080>              resb 128
   345                                  stacktop:
