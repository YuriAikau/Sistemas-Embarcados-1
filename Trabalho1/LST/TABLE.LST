     1                                  extern circle, line, cursor, caracter
     2                                  extern invalid_player, double_play, clear_header
     3                                  extern cor, azul, vermelho, branco_intenso, amarelo
     4                                  global draw_table, draw_position
     5                                  global proximo_jogador
     6                                  segment code
     7                                  ..start:
     8                                  
     9                                  draw_table:
    10 00000000 9C                          pushf
    11 00000001 50                          push 		ax
    12 00000002 53                          push 		bx
    13 00000003 51                          push		cx
    14 00000004 52                          push		dx
    15 00000005 56                          push		si
    16 00000006 57                          push		di
    17 00000007 55                          push		bp
    18                                  
    19                                      ; desenhando o fundo do jogo da velha
    20 00000008 C706[0000][0000]            mov		word[cor],branco_intenso
    21 0000000E B81400                      mov		ax,offset_tabela_x
    22 00000011 50                          push		ax
    23 00000012 B8AA00                      mov		ax,170
    24 00000015 50                          push		ax
    25 00000016 B86C02                      mov		ax,fim_tabela_x
    26 00000019 50                          push		ax
    27 0000001A B8AA00                      mov		ax,170
    28 0000001D 50                          push		ax
    29 0000001E E8(0000)                    call		line
    30                                  
    31 00000021 C706[0000][0000]            mov		word[cor],branco_intenso
    32 00000027 B81400                      mov		ax,offset_tabela_x
    33 0000002A 50                          push		ax
    34 0000002B B83601                      mov		ax,310
    35 0000002E 50                          push		ax
    36 0000002F B86C02                      mov		ax,fim_tabela_x
    37 00000032 50                          push		ax
    38 00000033 B83601                      mov		ax,310
    39 00000036 50                          push		ax
    40 00000037 E8(0000)                    call		line
    41                                  
    42 0000003A C706[0000][0000]            mov		word[cor],branco_intenso
    43 00000040 B8DC00                      mov		ax,220
    44 00000043 50                          push		ax
    45 00000044 B81E00                      mov		ax,offset_tabela_y
    46 00000047 50                          push		ax
    47 00000048 B8DC00                      mov		ax,220
    48 0000004B 50                          push		ax
    49 0000004C B8C201                      mov		ax,fim_tabela_y
    50 0000004F 50                          push		ax
    51 00000050 E8(0000)                    call		line
    52                                  
    53 00000053 C706[0000][0000]            mov		word[cor],branco_intenso
    54 00000059 B8A401                      mov		ax,420
    55 0000005C 50                          push		ax
    56 0000005D B81E00                      mov		ax,offset_tabela_y
    57 00000060 50                          push		ax
    58 00000061 B8A401                      mov		ax,420
    59 00000064 50                          push		ax
    60 00000065 B8C201                      mov		ax,fim_tabela_y
    61 00000068 50                          push		ax
    62 00000069 E8(0000)                    call		line
    63                                  
    64 0000006C 5D                          pop		bp
    65 0000006D 5F                          pop		di
    66 0000006E 5E                          pop		si
    67 0000006F 5A                          pop		dx
    68 00000070 59                          pop		cx
    69 00000071 5B                          pop		bx
    70 00000072 58                          pop		ax
    71 00000073 9D                          popf
    72 00000074 C3                          ret
    73                                  
    74                                  ;_____________________________________________________________________________
    75                                  ;   funcao desenha_posicao
    76                                  ;   push symbol; push x; push y; call draw_position; (0<=x<=2) e (0<=y<=2)
    77                                  draw_position:
    78 00000075 55                          push bp
    79 00000076 89E5                        mov bp,sp
    80 00000078 9C                          pushf
    81 00000079 50                          push 		ax
    82 0000007A 53                          push 		bx
    83 0000007B 51                          push		cx
    84 0000007C 52                          push		dx
    85 0000007D 56                          push		si
    86 0000007E 57                          push		di
    87                                  
    88 0000007F E8(0000)                    call clear_header
    89 00000082 8B4608                      mov ax,[bp+8] ;caractere ASCII correspondente ao símbolo a ser desenhado
    90 00000085 3B06[0000]                  cmp ax,[jogador_anterior]
    91 00000089 7416                        je double_play_jmp
    92 0000008B 3D5800                      cmp ax,'X'
    93 0000008E 740B                        je draw_ecks1
    94 00000090 3D4F00                      cmp ax,'O'
    95 00000093 7409                        je draw_circle1
    96                                  
    97 00000095 E8(0000)                    call invalid_player
    98                                  
    99 00000098 E9A900                      jmp draw_position_end
   100                                  
   101                                  draw_ecks1:
   102 0000009B E93B00                      jmp draw_ecks
   103                                  
   104                                  draw_circle1:
   105 0000009E E90600                      jmp draw_circle
   106                                  
   107                                  double_play_jmp:
   108 000000A1 E8(0000)                    call double_play
   109                                  
   110 000000A4 E99D00                      jmp draw_position_end
   111                                  
   112                                  draw_circle:
   113 000000A7 8B4606                      mov ax,[bp+6] ;posicao x da tabela (0-2)
   114 000000AA B3C8                        mov bl,largura_x
   115 000000AC F6E3                        mul bl
   116 000000AE 057800                      add ax,offset_tabela_x+(largura_x/2)
   117 000000B1 50                          push ax
   118                                  
   119 000000B2 8B4604                      mov ax,[bp+4] ;posicao y da tabela (0-2)
   120 000000B5 B38C                        mov bl,altura_y
   121 000000B7 F6E3                        mul bl
   122 000000B9 056400                      add ax,offset_tabela_y+(altura_y/2)
   123 000000BC 50                          push ax
   124                                  
   125 000000BD C706[0000][0000]            mov word[cor], azul
   126 000000C3 B83200                      mov ax,(altura_y/2)-20
   127 000000C6 50                          push ax
   128                                  
   129 000000C7 E8(0000)                    call circle
   130                                  
   131 000000CA B84F00                      mov ax,'O'
   132 000000CD A3[0000]                    mov word[jogador_anterior],ax
   133 000000D0 B85800                      mov ax,'X'
   134 000000D3 A3[0200]                    mov word[proximo_jogador],ax
   135                                  
   136 000000D6 E96B00                      jmp draw_position_end
   137                                  
   138                                  draw_ecks:
   139 000000D9 C706[0000][0000]            mov word[cor], vermelho
   140                                  ; desenhando a primeira "barra" do X
   141 000000DF 8B4606                      mov ax,[bp+6] ;posicao x da tabela (0-2)
   142 000000E2 B3C8                        mov bl,largura_x
   143 000000E4 F6E3                        mul bl
   144 000000E6 052800                      add ax,2*offset_tabela_x
   145 000000E9 50                          push ax ; posicao x1 da função line
   146                                  
   147 000000EA 8B4604                      mov ax,[bp+4] ;posicao y da tabela (0-2)
   148 000000ED B38C                        mov bl,altura_y
   149 000000EF F6E3                        mul bl
   150 000000F1 053C00                      add ax,2*offset_tabela_y
   151 000000F4 50                          push ax ; posicao y1 da função line
   152                                  
   153 000000F5 8B4606                      mov ax,[bp+6] ;posicao x da tabela (0-2)
   154 000000F8 40                          inc ax ; pega o final do "quadradinho" da posição atual
   155 000000F9 B3C8                        mov bl,largura_x
   156 000000FB F6E3                        mul bl
   157 000000FD 50                          push ax ; posicao x2 da função line
   158                                  
   159 000000FE 8B4604                      mov ax,[bp+4] ;posicao y da tabela (0-2)
   160 00000101 40                          inc ax ; pega o final do "quadradinho" da posição atual
   161 00000102 B38C                        mov bl,altura_y
   162 00000104 F6E3                        mul bl
   163 00000106 50                          push ax ; posicao y2 da função line
   164                                  
   165 00000107 E8(0000)                    call line
   166                                  
   167                                  ; desenhando a segunda "barra" do X
   168 0000010A 8B4606                      mov ax,[bp+6] ;posicao x da tabela (0-2)
   169 0000010D B3C8                        mov bl,largura_x
   170 0000010F F6E3                        mul bl
   171 00000111 052800                      add ax,2*offset_tabela_x
   172 00000114 50                          push ax ; posicao x1 da função line
   173                                  
   174 00000115 8B4604                      mov ax,[bp+4] ;posicao y da tabela (0-2)
   175 00000118 40                          inc ax ; pega o canto superior esquerdo do "quadradinho"
   176 00000119 B38C                        mov bl,altura_y
   177 0000011B F6E3                        mul bl
   178 0000011D 50                          push ax ; posicao y1 da função line
   179                                  
   180 0000011E 8B4606                      mov ax,[bp+6] ;posicao x da tabela (0-2)
   181 00000121 40                          inc ax ; pega o final do "quadradinho" da posição atual
   182 00000122 B3C8                        mov bl,largura_x
   183 00000124 F6E3                        mul bl
   184 00000126 50                          push ax ; posicao x2 da função line
   185                                  
   186 00000127 8B4604                      mov ax,[bp+4] ;posicao y da tabela (0-2)
   187 0000012A B38C                        mov bl,altura_y
   188 0000012C F6E3                        mul bl
   189 0000012E 053C00                      add ax, 2*offset_tabela_y
   190 00000131 50                          push ax ; posicao y2 da função line
   191                                  
   192 00000132 E8(0000)                    call line
   193                                  
   194 00000135 B85800                      mov ax,'X'
   195 00000138 A3[0000]                    mov word[jogador_anterior],ax
   196 0000013B B84F00                      mov ax,'O'
   197 0000013E A3[0200]                    mov word[proximo_jogador],ax
   198                                  
   199 00000141 E90000                      jmp draw_position_end
   200                                  
   201                                  draw_position_end:
   202 00000144 5F                          pop		di
   203 00000145 5E                          pop		si
   204 00000146 5A                          pop		dx
   205 00000147 59                          pop		cx
   206 00000148 5B                          pop		bx
   207 00000149 58                          pop		ax
   208 0000014A 9D                          popf
   209 0000014B 5D                          pop		bp
   210 0000014C C20600                      ret 6
   211                                  
   212                                  segment data
   213                                  ;coordenadas do inicio (canto inferior esquerdo) e do fim (canto superior direito) da tabela do jogo da velha
   214                                      offset_tabela_x     equ     20
   215                                      offset_tabela_y     equ     30
   216                                      fim_tabela_x        equ     620
   217                                      fim_tabela_y        equ     450
   218                                  
   219                                  ; dimensoes de cada quadradinho do jogo da velha
   220                                      largura_x           equ     200
   221                                      altura_y            equ     140
   222                                  
   223                                  ; vez do jogador anterior
   224 00000000 2000                        jogador_anterior    dw      ' '
   225 00000002 2000                        proximo_jogador     dw      ' '
   226                                  
   227                                  segment stack stack
   228 00000000 <res 00000080>              resb 128
   229                                  stacktop:
