     1                                  extern circle, line, cursor, caracter
     2                                  extern invalid_player, double_play, invalid_position, clear_header
     3                                  extern cor, cyan_claro, magenta_claro, branco_intenso, amarelo
     4                                  global draw_table, draw_position
     5                                  global proximo_jogador
     6                                  segment code
     7                                  ..start:
     8                                  
     9                                  draw_table:
    10 00000000 9C                          pushf
    11 00000001 50                          push 		ax
    12 00000002 53                          push 		bx
    13 00000003 51                          push		cx
    14 00000004 52                          push		dx
    15 00000005 56                          push		si
    16 00000006 57                          push		di
    17 00000007 55                          push		bp
    18                                  
    19                                      ; desenhando o fundo do jogo da velha
    20 00000008 C706[0000][0000]            mov		word[cor],branco_intenso
    21 0000000E B81400                      mov		ax,offset_tabela_x
    22 00000011 50                          push		ax
    23 00000012 B8E600                      mov		ax,offset_tabela_y+altura_y
    24 00000015 50                          push		ax
    25 00000016 B86C02                      mov		ax,fim_tabela_x
    26 00000019 50                          push		ax
    27 0000001A B8E600                      mov		ax,offset_tabela_y+altura_y
    28 0000001D 50                          push		ax
    29 0000001E E8(0000)                    call		line
    30                                  
    31 00000021 C706[0000][0000]            mov		word[cor],branco_intenso
    32 00000027 B81400                      mov		ax,offset_tabela_x
    33 0000002A 50                          push		ax
    34 0000002B B85401                      mov		ax,offset_tabela_y+2*altura_y
    35 0000002E 50                          push		ax
    36 0000002F B86C02                      mov		ax,fim_tabela_x
    37 00000032 50                          push		ax
    38 00000033 B85401                      mov		ax,offset_tabela_y+2*altura_y
    39 00000036 50                          push		ax
    40 00000037 E8(0000)                    call		line
    41                                  
    42 0000003A C706[0000][0000]            mov		word[cor],branco_intenso
    43 00000040 B8DC00                      mov		ax,offset_tabela_x+largura_x
    44 00000043 50                          push		ax
    45 00000044 B87800                      mov		ax,offset_tabela_y
    46 00000047 50                          push		ax
    47 00000048 B8DC00                      mov		ax,offset_tabela_x+largura_x
    48 0000004B 50                          push		ax
    49 0000004C B8C201                      mov		ax,fim_tabela_y
    50 0000004F 50                          push		ax
    51 00000050 E8(0000)                    call		line
    52                                  
    53 00000053 C706[0000][0000]            mov		word[cor],branco_intenso
    54 00000059 B8A401                      mov		ax,offset_tabela_x+2*largura_x
    55 0000005C 50                          push		ax
    56 0000005D B87800                      mov		ax,offset_tabela_y
    57 00000060 50                          push		ax
    58 00000061 B8A401                      mov		ax,offset_tabela_x+2*largura_x
    59 00000064 50                          push		ax
    60 00000065 B8C201                      mov		ax,fim_tabela_y
    61 00000068 50                          push		ax
    62 00000069 E8(0000)                    call		line
    63                                  
    64 0000006C B91200                      mov cx, 18 ; número de caracteres na mensagem "Campo de comando: "
    65 0000006F 31DB                        xor bx,bx
    66 00000071 B619                        mov dh,25
    67 00000073 B202                        mov dl,2
    68 00000075 C706[0000][0000]            mov word[cor], branco_intenso
    69                                  
    70                                  draw_cmd:
    71 0000007B E8(0000)                    call	cursor
    72 0000007E 8A87[0700]                  mov     al,[bx+campo_cmd]
    73 00000082 E8(0000)                    call	caracter
    74 00000085 43                          inc     bx			;proximo caracter
    75 00000086 FEC2                        inc		dl			;avanca a coluna
    76 00000088 E2F1                        loop    draw_cmd
    77                                  
    78 0000008A B91400                      mov cx, 20 ; número de caracteres na mensagem "Campo de mensagens: "
    79 0000008D 31DB                        xor bx,bx
    80 0000008F B61B                        mov dh,27
    81 00000091 B202                        mov dl,2
    82 00000093 C706[0000][0000]            mov word[cor], branco_intenso
    83                                  
    84                                  draw_msg:
    85 00000099 E8(0000)                    call	cursor
    86 0000009C 8A87[1900]                  mov     al,[bx+campo_msg]
    87 000000A0 E8(0000)                    call	caracter
    88 000000A3 43                          inc     bx			;proximo caracter
    89 000000A4 FEC2                        inc		dl			;avanca a coluna
    90 000000A6 E2F1                        loop    draw_msg
    91                                  
    92 000000A8 5D                          pop		bp
    93 000000A9 5F                          pop		di
    94 000000AA 5E                          pop		si
    95 000000AB 5A                          pop		dx
    96 000000AC 59                          pop		cx
    97 000000AD 5B                          pop		bx
    98 000000AE 58                          pop		ax
    99 000000AF 9D                          popf
   100 000000B0 C3                          ret
   101                                  
   102                                  ;_____________________________________________________________________________
   103                                  ;   funcao desenha_posicao
   104                                  ;   push symbol; push x; push y; call draw_position; (0<=x<=2) e (0<=y<=2)
   105                                  draw_position:
   106 000000B1 55                          push bp
   107 000000B2 89E5                        mov bp,sp
   108 000000B4 9C                          pushf
   109 000000B5 50                          push 		ax
   110 000000B6 53                          push 		bx
   111 000000B7 51                          push		cx
   112 000000B8 52                          push		dx
   113 000000B9 56                          push		si
   114 000000BA 57                          push		di
   115                                  
   116 000000BB 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   117 000000BE 3D0300                      cmp ax,3
   118 000000C1 773A                        ja invalid_pos
   119 000000C3 3D0100                      cmp ax,1
   120 000000C6 7235                        jb invalid_pos
   121                                  
   122 000000C8 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   123 000000CB 3D0300                      cmp ax,3
   124 000000CE 772D                        ja invalid_pos
   125 000000D0 3D0100                      cmp ax,1
   126 000000D3 7228                        jb invalid_pos
   127                                  
   128 000000D5 E8(0000)                    call clear_header
   129 000000D8 8B4608                      mov ax,[bp+8] ;caractere ASCII correspondente ao símbolo a ser desenhado
   130 000000DB 3B06[0000]                  cmp ax,[jogador_anterior]
   131 000000DF 7416                        je double_play_jmp
   132                                  
   133 000000E1 3D5800                      cmp ax,'X'
   134 000000E4 740B                        je draw_ecks1
   135 000000E6 3D4F00                      cmp ax,'O'
   136 000000E9 7409                        je draw_circle1
   137                                  
   138 000000EB E8(0000)                    call invalid_player
   139                                  
   140 000000EE E9E000                      jmp draw_position_end
   141                                  
   142                                  draw_ecks1:
   143 000000F1 E94A00                      jmp draw_ecks
   144                                  
   145                                  draw_circle1:
   146 000000F4 E90C00                      jmp draw_circle
   147                                  
   148                                  double_play_jmp:
   149 000000F7 E8(0000)                    call double_play
   150                                  
   151 000000FA E9D400                      jmp draw_position_end
   152                                  
   153                                  invalid_pos:
   154 000000FD E8(0000)                    call invalid_position
   155 00000100 E9CE00                      jmp draw_position_end
   156                                  draw_circle:
   157 00000103 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   158 00000106 48                          dec ax
   159 00000107 B3C8                        mov bl,largura_x
   160 00000109 F6E3                        mul bl
   161 0000010B 057800                      add ax,offset_tabela_x+(largura_x/2)
   162 0000010E 50                          push ax
   163                                  
   164 0000010F 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   165 00000112 48                          dec ax
   166 00000113 B36E                        mov bl,altura_y
   167 00000115 F6E3                        mul bl
   168 00000117 055500                      add ax,margem_y+(altura_y/2)
   169 0000011A 31DB                        xor bx,bx
   170 0000011C BBDF01                      mov bx,479
   171 0000011F 29C3                        sub bx,ax
   172 00000121 53                          push bx
   173                                  
   174 00000122 C706[0000][0000]            mov word[cor], cyan_claro
   175 00000128 B82D00                      mov ax,(altura_y/2)-offset_quadrado_y
   176 0000012B 50                          push ax
   177                                  
   178 0000012C E8(0000)                    call circle
   179                                  
   180 0000012F B84F00                      mov ax,'O'
   181 00000132 A3[0000]                    mov word[jogador_anterior],ax
   182 00000135 B85800                      mov ax,'X'
   183 00000138 A3[0200]                    mov word[proximo_jogador],ax
   184                                  
   185 0000013B E99300                      jmp draw_position_end
   186                                  
   187                                  draw_ecks:
   188 0000013E C706[0000][0000]            mov word[cor], magenta_claro
   189                                  ; desenhando a primeira "barra" do X
   190 00000144 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   191 00000147 48                          dec ax
   192 00000148 B3C8                        mov bl,largura_x
   193 0000014A F6E3                        mul bl
   194 0000014C 051E00                      add ax,offset_tabela_x+offset_quadrado_x
   195 0000014F 50                          push ax ; posicao x1 da função line
   196                                  
   197 00000150 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   198 00000153 48                          dec ax
   199 00000154 B36E                        mov bl,altura_y
   200 00000156 F6E3                        mul bl
   201 00000158 052800                      add ax,margem_y+offset_quadrado_y
   202 0000015B 31DB                        xor bx,bx
   203 0000015D BBDF01                      mov bx,479
   204 00000160 29C3                        sub bx,ax
   205 00000162 53                          push bx ; posicao y1 da função line
   206                                  
   207 00000163 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   208 00000166 B3C8                        mov bl,largura_x
   209 00000168 F6E3                        mul bl
   210 0000016A 050A00                      add ax,offset_tabela_x-offset_quadrado_x
   211 0000016D 50                          push ax ; posicao x2 da função line
   212                                  
   213 0000016E 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   214 00000171 B36E                        mov bl,altura_y
   215 00000173 F6E3                        mul bl
   216 00000175 051400                      add ax,margem_y-offset_quadrado_y
   217 00000178 31DB                        xor bx,bx
   218 0000017A BBDF01                      mov bx,479
   219 0000017D 29C3                        sub bx,ax
   220 0000017F 53                          push bx ; posicao y2 da função line
   221                                  
   222 00000180 E8(0000)                    call line
   223                                  
   224                                  ; desenhando a segunda "barra" do X
   225 00000183 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   226 00000186 48                          dec ax
   227 00000187 B3C8                        mov bl,largura_x
   228 00000189 F6E3                        mul bl
   229 0000018B 051E00                      add ax,offset_tabela_x+offset_quadrado_x
   230 0000018E 50                          push ax ; posicao x1 da função line
   231                                  
   232 0000018F 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   233 00000192 B36E                        mov bl,altura_y
   234 00000194 F6E3                        mul bl
   235 00000196 051400                      add ax,margem_y-offset_quadrado_y
   236 00000199 31DB                        xor bx,bx
   237 0000019B BBDF01                      mov bx,479
   238 0000019E 29C3                        sub bx,ax
   239 000001A0 53                          push bx ; posicao y1 da função line
   240                                  
   241 000001A1 8B4604                      mov ax,[bp+4] ;posicao c da tabela (0-2)
   242 000001A4 B3C8                        mov bl,largura_x
   243 000001A6 F6E3                        mul bl
   244 000001A8 050A00                      add ax,offset_tabela_x-offset_quadrado_x
   245 000001AB 50                          push ax ; posicao x2 da função line
   246                                  
   247 000001AC 8B4606                      mov ax,[bp+6] ;posicao l da tabela (0-2)
   248 000001AF 48                          dec ax
   249 000001B0 B36E                        mov bl,altura_y
   250 000001B2 F6E3                        mul bl
   251 000001B4 052800                      add ax, margem_y+offset_quadrado_y
   252 000001B7 31DB                        xor bx,bx
   253 000001B9 BBDF01                      mov bx,479
   254 000001BC 29C3                        sub bx,ax
   255 000001BE 53                          push bx ; posicao y2 da função line
   256                                  
   257 000001BF E8(0000)                    call line
   258                                  
   259 000001C2 B85800                      mov ax,'X'
   260 000001C5 A3[0000]                    mov word[jogador_anterior],ax
   261 000001C8 B84F00                      mov ax,'O'
   262 000001CB A3[0200]                    mov word[proximo_jogador],ax
   263                                  
   264 000001CE E90000                      jmp draw_position_end
   265                                  
   266                                  draw_position_end:
   267 000001D1 5F                          pop		di
   268 000001D2 5E                          pop		si
   269 000001D3 5A                          pop		dx
   270 000001D4 59                          pop		cx
   271 000001D5 5B                          pop		bx
   272 000001D6 58                          pop		ax
   273 000001D7 9D                          popf
   274 000001D8 5D                          pop		bp
   275 000001D9 C20600                      ret 6
   276                                  
   277                                  segment data
   278                                  ;coordenadas do inicio (canto inferior esquerdo) e do fim (canto superior direito) da tabela do jogo da velha
   279                                      offset_tabela_x     equ     20
   280                                      offset_tabela_y     equ     120
   281                                      margem_y            equ     30
   282                                      fim_tabela_x        equ     620
   283                                      fim_tabela_y        equ     450
   284                                  
   285                                  ; dimensoes e offsets de cada quadradinho do jogo da velha
   286                                      offset_quadrado_x   equ     10
   287                                      offset_quadrado_y   equ     10
   288                                      largura_x           equ     200
   289                                      altura_y            equ     110
   290                                  
   291                                  ; vez do jogador anterior
   292 00000000 2000                        jogador_anterior    dw      ' '
   293 00000002 2000                        proximo_jogador     dw      ' '
   294                                  
   295                                  ; valores possíveis de linhas e colunas
   296 00000004 313233                      n_linhas_colunas    db      '1','2','3'
   297                                  
   298                                  ; strings pertencentes à tela
   299 00000007 43616D706F20646520-         campo_cmd           db      'Campo de comando: '
   300 00000010 636F6D616E646F3A20 
   301 00000019 43616D706F20646520-         campo_msg           db      'Campo de mensagens: '
   302 00000022 6D656E736167656E73-
   303 0000002B 3A20               
   304                                  
   305                                  segment stack stack
   306 00000000 <res 00000080>              resb 128
   307                                  stacktop:
