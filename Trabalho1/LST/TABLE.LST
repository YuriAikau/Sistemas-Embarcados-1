     1                                  global draw_table, draw_position
     2                                  global proximo_jogador, jogador_anterior, matriz_tabela
     3                                  global len_campo_input, altura_input
     4                                  global offset_tabela_x, offset_tabela_y, fim_tabela_x, fim_tabela_y, largura_x, altura_y
     5                                  extern circle, line, cursor, caracter
     6                                  extern invalid_player, double_play, invalid_position, position_filled, clear_character, draw_previous_cmd, clear_cmd
     7                                  extern cor, cyan_claro, magenta_claro, branco_intenso, amarelo
     8                                  extern n_jogadas
     9                                  segment code
    10                                  ..start:
    11                                  
    12                                  draw_table:
    13 00000000 9C                          pushf
    14 00000001 50                          push 		ax
    15 00000002 53                          push 		bx
    16 00000003 51                          push		cx
    17 00000004 52                          push		dx
    18 00000005 56                          push		si
    19 00000006 57                          push		di
    20 00000007 55                          push		bp
    21                                  
    22                                      ; desenhando o fundo do jogo da velha
    23 00000008 C706[0000][0000]            mov		word[cor],branco_intenso
    24 0000000E B81400                      mov		ax,offset_tabela_x
    25 00000011 50                          push		ax
    26 00000012 B8E600                      mov		ax,offset_tabela_y+altura_y
    27 00000015 50                          push		ax
    28 00000016 B86C02                      mov		ax,fim_tabela_x
    29 00000019 50                          push		ax
    30 0000001A B8E600                      mov		ax,offset_tabela_y+altura_y
    31 0000001D 50                          push		ax
    32 0000001E E8(0000)                    call		line
    33                                  
    34 00000021 C706[0000][0000]            mov		word[cor],branco_intenso
    35 00000027 B81400                      mov		ax,offset_tabela_x
    36 0000002A 50                          push		ax
    37 0000002B B85401                      mov		ax,offset_tabela_y+2*altura_y
    38 0000002E 50                          push		ax
    39 0000002F B86C02                      mov		ax,fim_tabela_x
    40 00000032 50                          push		ax
    41 00000033 B85401                      mov		ax,offset_tabela_y+2*altura_y
    42 00000036 50                          push		ax
    43 00000037 E8(0000)                    call		line
    44                                  
    45 0000003A C706[0000][0000]            mov		word[cor],branco_intenso
    46 00000040 B8DC00                      mov		ax,offset_tabela_x+largura_x
    47 00000043 50                          push		ax
    48 00000044 B87800                      mov		ax,offset_tabela_y
    49 00000047 50                          push		ax
    50 00000048 B8DC00                      mov		ax,offset_tabela_x+largura_x
    51 0000004B 50                          push		ax
    52 0000004C B8C201                      mov		ax,fim_tabela_y
    53 0000004F 50                          push		ax
    54 00000050 E8(0000)                    call		line
    55                                  
    56 00000053 C706[0000][0000]            mov		word[cor],branco_intenso
    57 00000059 B8A401                      mov		ax,offset_tabela_x+2*largura_x
    58 0000005C 50                          push		ax
    59 0000005D B87800                      mov		ax,offset_tabela_y
    60 00000060 50                          push		ax
    61 00000061 B8A401                      mov		ax,offset_tabela_x+2*largura_x
    62 00000064 50                          push		ax
    63 00000065 B8C201                      mov		ax,fim_tabela_y
    64 00000068 50                          push		ax
    65 00000069 E8(0000)                    call		line
    66                                  
    67 0000006C B91600                      mov cx, len_campo_input ; número de caracteres na mensagem "Campo de comando: "
    68 0000006F 31DB                        xor bx,bx
    69 00000071 B600                        mov dh,altura_input
    70 00000073 B202                        mov dl,2
    71 00000075 C706[0000][0000]            mov word[cor], branco_intenso
    72                                  
    73                                  draw_input:
    74 0000007B E8(0000)                    call	cursor
    75 0000007E 8A87[1000]                  mov     al,[bx+campo_input]
    76 00000082 E8(0000)                    call	caracter
    77 00000085 43                          inc     bx			;proximo caracter
    78 00000086 FEC2                        inc		dl			;avanca a coluna
    79 00000088 E2F1                        loop    draw_input
    80                                  
    81 0000008A B91200                      mov cx, len_campo_cmd ; número de caracteres na mensagem "Campo de comando: "
    82 0000008D 31DB                        xor bx,bx
    83 0000008F B619                        mov dh,altura_cmd
    84 00000091 B202                        mov dl,2
    85 00000093 C706[0000][0000]            mov word[cor], branco_intenso
    86                                  
    87                                  draw_cmd:
    88 00000099 E8(0000)                    call	cursor
    89 0000009C 8A87[2600]                  mov     al,[bx+campo_cmd]
    90 000000A0 E8(0000)                    call	caracter
    91 000000A3 43                          inc     bx			;proximo caracter
    92 000000A4 FEC2                        inc		dl			;avanca a coluna
    93 000000A6 E2F1                        loop    draw_cmd
    94                                  
    95 000000A8 B91400                      mov cx, len_campo_msg ; número de caracteres na mensagem "Campo de mensagens: "
    96 000000AB 31DB                        xor bx,bx
    97 000000AD B61B                        mov dh,altura_msg
    98 000000AF B202                        mov dl,2
    99 000000B1 C706[0000][0000]            mov word[cor], branco_intenso
   100                                  
   101                                  draw_msg:
   102 000000B7 E8(0000)                    call	cursor
   103 000000BA 8A87[3800]                  mov     al,[bx+campo_msg]
   104 000000BE E8(0000)                    call	caracter
   105 000000C1 43                          inc     bx			;proximo caracter
   106 000000C2 FEC2                        inc		dl			;avanca a coluna
   107 000000C4 E2F1                        loop    draw_msg
   108                                  
   109 000000C6 5D                          pop		bp
   110 000000C7 5F                          pop		di
   111 000000C8 5E                          pop		si
   112 000000C9 5A                          pop		dx
   113 000000CA 59                          pop		cx
   114 000000CB 5B                          pop		bx
   115 000000CC 58                          pop		ax
   116 000000CD 9D                          popf
   117 000000CE C3                          ret
   118                                  
   119                                  ;_____________________________________________________________________________
   120                                  ;   funcao desenha_posicao
   121                                  ;   push symbol; push x; push y; call draw_position; (0<=x<=2) e (0<=y<=2)
   122                                  draw_position:
   123 000000CF 55                          push bp
   124 000000D0 89E5                        mov bp,sp
   125 000000D2 9C                          pushf
   126 000000D3 50                          push 		ax
   127 000000D4 53                          push 		bx
   128 000000D5 51                          push		cx
   129 000000D6 52                          push		dx
   130 000000D7 56                          push		si
   131 000000D8 57                          push		di
   132                                  
   133 000000D9 B81400                      mov ax,len_campo_msg
   134 000000DC 50                          push ax
   135 000000DD B83200                      mov ax,50
   136 000000E0 50                          push ax
   137 000000E1 B81B00                      mov ax,altura_msg
   138 000000E4 50                          push ax
   139 000000E5 E8(0000)                    call clear_character
   140                                  
   141 000000E8 8B4604                      mov ax,[bp+4] ;posicao c da tabela (1-3)
   142 000000EB 3D0300                      cmp ax,3
   143 000000EE 7769                        ja invalid_pos
   144 000000F0 3D0100                      cmp ax,1
   145 000000F3 7264                        jb invalid_pos
   146                                  
   147 000000F5 8B4606                      mov ax,[bp+6] ;posicao l da tabela (1-3)
   148 000000F8 3D0300                      cmp ax,3
   149 000000FB 775C                        ja invalid_pos
   150 000000FD 3D0100                      cmp ax,1
   151 00000100 7257                        jb invalid_pos
   152                                  
   153 00000102 8B4606                      mov ax,[bp+6] ; linha da tabela
   154 00000105 48                          dec ax
   155 00000106 25FF00                      and ax,00FFh
   156 00000109 B303                        mov bl,3
   157 0000010B F6E3                        mul bl
   158 0000010D 31DB                        xor bx,bx
   159 0000010F 8B5E04                      mov bx,[bp+4] ; coluna da tabela
   160 00000112 4B                          dec bx
   161 00000113 01C3                        add bx,ax
   162 00000115 80BF[0000]20                cmp byte[bx+matriz_tabela],' '
   163 0000011A 7543                        jne filled_position
   164                                  draw_position1:
   165 0000011C 8B4608                      mov ax,[bp+8] ;caractere ASCII correspondente ao símbolo a ser desenhado
   166 0000011F 3B06[0900]                  cmp ax,[jogador_anterior]
   167 00000123 742E                        je double_play_jmp
   168                                  
   169 00000125 3D5800                      cmp ax,'X'
   170 00000128 740B                        je draw_ecks1
   171 0000012A 3D4300                      cmp ax,'C'
   172 0000012D 7415                        je draw_circle1
   173                                  
   174 0000012F E8(0000)                    call invalid_player
   175                                  
   176 00000132 E93601                      jmp draw_position_end
   177                                  
   178                                  draw_ecks1:
   179 00000135 C706[0000][0000]            mov word[cor], magenta_claro
   180 0000013B E8(0000)                    call draw_previous_cmd
   181 0000013E E8(0000)                    call clear_cmd
   182 00000141 E97800                      jmp draw_ecks
   183                                  
   184                                  draw_circle1:
   185 00000144 C706[0000][0000]            mov word[cor], cyan_claro
   186 0000014A E8(0000)                    call draw_previous_cmd
   187 0000014D E8(0000)                    call clear_cmd
   188 00000150 E91200                      jmp draw_circle
   189                                  
   190                                  double_play_jmp:
   191 00000153 E8(0000)                    call double_play
   192                                  
   193 00000156 E91201                      jmp draw_position_end
   194                                  
   195                                  invalid_pos:
   196 00000159 E8(0000)                    call invalid_position
   197 0000015C E90C01                      jmp draw_position_end
   198                                  
   199                                  filled_position:
   200 0000015F E8(0000)                    call position_filled
   201 00000162 E90601                      jmp draw_position_end
   202                                  draw_circle:
   203 00000165 C706[0000][0000]            mov word[cor], cyan_claro
   204 0000016B 8B4606                      mov ax,[bp+6] ; linha da tabela
   205 0000016E 48                          dec ax
   206 0000016F 25FF00                      and ax,00FFh
   207 00000172 B303                        mov bl,3
   208 00000174 F6E3                        mul bl
   209 00000176 31DB                        xor bx,bx
   210 00000178 8B5E04                      mov bx,[bp+4] ; coluna da tabela
   211 0000017B 4B                          dec bx
   212 0000017C 01C3                        add bx,ax
   213 0000017E C687[0000]43                mov byte[bx+matriz_tabela],'C'
   214                                  
   215 00000183 8B4604                      mov ax,[bp+4] ;posicao c da tabela (1-3)
   216 00000186 48                          dec ax
   217 00000187 B3C8                        mov bl,largura_x
   218 00000189 F6E3                        mul bl
   219 0000018B 057800                      add ax,offset_tabela_x+(largura_x/2)
   220 0000018E 50                          push ax
   221                                  
   222 0000018F 8B4606                      mov ax,[bp+6] ;posicao l da tabela (1-3)
   223 00000192 48                          dec ax
   224 00000193 B36E                        mov bl,altura_y
   225 00000195 F6E3                        mul bl
   226 00000197 055500                      add ax,margem_y+(altura_y/2)
   227 0000019A 31DB                        xor bx,bx
   228 0000019C BBDF01                      mov bx,479
   229 0000019F 29C3                        sub bx,ax
   230 000001A1 53                          push bx
   231                                  
   232 000001A2 B82D00                      mov ax,(altura_y/2)-offset_quadrado_y
   233 000001A5 50                          push ax
   234                                  
   235 000001A6 E8(0000)                    call circle
   236                                  
   237 000001A9 B84300                      mov ax,'C'
   238 000001AC A3[0900]                    mov word[jogador_anterior],ax
   239 000001AF B85800                      mov ax,'X'
   240 000001B2 A3[0B00]                    mov word[proximo_jogador],ax
   241                                  
   242 000001B5 FF06[0000]                  inc word[n_jogadas]
   243                                  
   244 000001B9 E9AF00                      jmp draw_position_end
   245                                  
   246                                  draw_ecks:
   247 000001BC C706[0000][0000]            mov word[cor], magenta_claro
   248 000001C2 8B4606                      mov ax,[bp+6] ; linha da tabela
   249 000001C5 48                          dec ax
   250 000001C6 25FF00                      and ax,00FFh
   251 000001C9 B303                        mov bl,3
   252 000001CB F6E3                        mul bl
   253 000001CD 31DB                        xor bx,bx
   254 000001CF 8B5E04                      mov bx,[bp+4] ; coluna da tabela
   255 000001D2 4B                          dec bx
   256 000001D3 01C3                        add bx,ax
   257 000001D5 C687[0000]58                mov byte[bx+matriz_tabela],'X'
   258                                  
   259                                  ; desenhando a primeira "barra" do X
   260 000001DA 8B4604                      mov ax,[bp+4] ;posicao c da tabela (1-3)
   261 000001DD 48                          dec ax
   262 000001DE B3C8                        mov bl,largura_x
   263 000001E0 F6E3                        mul bl
   264 000001E2 051E00                      add ax,offset_tabela_x+offset_quadrado_x
   265 000001E5 50                          push ax ; posicao x1 da função line
   266                                  
   267 000001E6 8B4606                      mov ax,[bp+6] ;posicao l da tabela (1-3)
   268 000001E9 48                          dec ax
   269 000001EA B36E                        mov bl,altura_y
   270 000001EC F6E3                        mul bl
   271 000001EE 052800                      add ax,margem_y+offset_quadrado_y
   272 000001F1 31DB                        xor bx,bx
   273 000001F3 BBDF01                      mov bx,479
   274 000001F6 29C3                        sub bx,ax
   275 000001F8 53                          push bx ; posicao y1 da função line
   276                                  
   277 000001F9 8B4604                      mov ax,[bp+4] ;posicao c da tabela (1-3)
   278 000001FC B3C8                        mov bl,largura_x
   279 000001FE F6E3                        mul bl
   280 00000200 050A00                      add ax,offset_tabela_x-offset_quadrado_x
   281 00000203 50                          push ax ; posicao x2 da função line
   282                                  
   283 00000204 8B4606                      mov ax,[bp+6] ;posicao l da tabela (1-3)
   284 00000207 B36E                        mov bl,altura_y
   285 00000209 F6E3                        mul bl
   286 0000020B 051400                      add ax,margem_y-offset_quadrado_y
   287 0000020E 31DB                        xor bx,bx
   288 00000210 BBDF01                      mov bx,479
   289 00000213 29C3                        sub bx,ax
   290 00000215 53                          push bx ; posicao y2 da função line
   291                                  
   292 00000216 E8(0000)                    call line
   293                                  
   294                                  ; desenhando a segunda "barra" do X
   295 00000219 8B4604                      mov ax,[bp+4] ;posicao c da tabela (1-3)
   296 0000021C 48                          dec ax
   297 0000021D B3C8                        mov bl,largura_x
   298 0000021F F6E3                        mul bl
   299 00000221 051E00                      add ax,offset_tabela_x+offset_quadrado_x
   300 00000224 50                          push ax ; posicao x1 da função line
   301                                  
   302 00000225 8B4606                      mov ax,[bp+6] ;posicao l da tabela (1-3)
   303 00000228 B36E                        mov bl,altura_y
   304 0000022A F6E3                        mul bl
   305 0000022C 051400                      add ax,margem_y-offset_quadrado_y
   306 0000022F 31DB                        xor bx,bx
   307 00000231 BBDF01                      mov bx,479
   308 00000234 29C3                        sub bx,ax
   309 00000236 53                          push bx ; posicao y1 da função line
   310                                  
   311 00000237 8B4604                      mov ax,[bp+4] ;posicao c da tabela (1-3)
   312 0000023A B3C8                        mov bl,largura_x
   313 0000023C F6E3                        mul bl
   314 0000023E 050A00                      add ax,offset_tabela_x-offset_quadrado_x
   315 00000241 50                          push ax ; posicao x2 da função line
   316                                  
   317 00000242 8B4606                      mov ax,[bp+6] ;posicao l da tabela (1-3)
   318 00000245 48                          dec ax
   319 00000246 B36E                        mov bl,altura_y
   320 00000248 F6E3                        mul bl
   321 0000024A 052800                      add ax, margem_y+offset_quadrado_y
   322 0000024D 31DB                        xor bx,bx
   323 0000024F BBDF01                      mov bx,479
   324 00000252 29C3                        sub bx,ax
   325 00000254 53                          push bx ; posicao y2 da função line
   326                                  
   327 00000255 E8(0000)                    call line
   328                                  
   329 00000258 B85800                      mov ax,'X'
   330 0000025B A3[0900]                    mov word[jogador_anterior],ax
   331 0000025E B84300                      mov ax,'C'
   332 00000261 A3[0B00]                    mov word[proximo_jogador],ax
   333                                  
   334 00000264 FF06[0000]                  inc word[n_jogadas]
   335                                  
   336 00000268 E90000                      jmp draw_position_end
   337                                  
   338                                  draw_position_end:
   339 0000026B 5F                          pop		di
   340 0000026C 5E                          pop		si
   341 0000026D 5A                          pop		dx
   342 0000026E 59                          pop		cx
   343 0000026F 5B                          pop		bx
   344 00000270 58                          pop		ax
   345 00000271 9D                          popf
   346 00000272 5D                          pop		bp
   347 00000273 C20600                      ret 6
   348                                  
   349                                  segment data
   350                                  ; coordenadas do inicio (canto inferior esquerdo) e do fim (canto superior direito) da tabela do jogo da velha
   351                                      offset_tabela_x     equ     20
   352                                      offset_tabela_y     equ     120
   353                                      fim_tabela_x        equ     620
   354                                      fim_tabela_y        equ     450
   355                                      margem_y            equ     30
   356                                  
   357                                  ; dimensoes e offsets de cada quadradinho do jogo da velha
   358                                      offset_quadrado_x   equ     10
   359                                      offset_quadrado_y   equ     10
   360                                      largura_x           equ     200
   361                                      altura_y            equ     110
   362                                  
   363                                  ; matriz que representa o tabuleiro na memória
   364 00000000 202020202020202020          matriz_tabela       db      ' ',' ',' ',' ',' ',' ',' ',' ',' '
   365                                  
   366                                  ; vez do jogador anterior
   367 00000009 2000                        jogador_anterior    dw      ' '
   368 0000000B 2000                        proximo_jogador     dw      ' '
   369                                  
   370                                  ; valores possíveis de linhas e colunas
   371 0000000D 313233                      n_linhas_colunas    db      '1','2','3'
   372                                  
   373                                  ; strings pertencentes à tela
   374 00000010 446967697465206F20-         campo_input         db      'Digite o seu comando: '
   375 00000019 73657520636F6D616E-
   376 00000022 646F3A20           
   377                                      len_campo_input     equ     22
   378                                      altura_input        equ     0
   379 00000026 43616D706F20646520-         campo_cmd           db      'Campo de comando: '
   380 0000002F 636F6D616E646F3A20 
   381                                      len_campo_cmd       equ     18
   382                                      altura_cmd          equ     25
   383 00000038 43616D706F20646520-         campo_msg           db      'Campo de mensagens: '
   384 00000041 6D656E736167656E73-
   385 0000004A 3A20               
   386                                      len_campo_msg       equ     20
   387                                      altura_msg          equ     27
   388                                  
   389                                  segment stack stack
   390 00000000 <res 00000080>              resb 128
   391                                  stacktop:
